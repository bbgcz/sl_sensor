<launch>

  <arg name="save_filename" doc="Name of folder where images will be saved" default="testing" />
  <arg name="save_directory" doc="Directory where folder will with images will be generated" default="$(find sl_sensor_calibration)/calibration_sessions/" />
  <arg name="projector_yaml_directory" doc="projector_yaml_directory" default="$(find sl_sensor_projector)/projector_yaml/lightcrafter4500.yaml" />
  <arg name="primary_camera_name" doc="Name of camera as declared in in versavis, used for triangulation" default="cam2"/>
  <arg name="secondary_camera_name" doc="Name of camera as declared in in versavis, that will be used for colour shading" default="cam1"/>

  <include file="$(find sl_sensor_projector)/launch/lightcrafter_4500_projector.launch" />

  <node pkg="nodelet" type="nodelet" name="standalone_nodelet"  args="manager" output="screen">
    <param name="num_worker_threads" value="10" />
  </node>

  <node pkg="nodelet" type="nodelet" name="image_synchroniser" args="load sl_sensor_image_acquisition/ImageSynchroniserNodelet standalone_nodelet" output="screen">
    <rosparam command="load" file="$(find sl_sensor_image_acquisition)/param/default_parameters.yaml" />
    <param name="image_topics" type="string" value="/versavis/$(arg primary_camera_name)/image_raw /versavis/$(arg secondary_camera_name)/image_raw" />    
    <param name="frame_id" type="string" value="sl_sensor" />
    <param name="projector_yaml_directory" type="string" value="$(arg projector_yaml_directory)"/>
    <param name="fixed_pattern_name" type="string" value="calibration" />
  </node>		  

  <node pkg="nodelet" type="nodelet" name="decoder" args="load sl_sensor_codec/DecoderNodelet standalone_nodelet" output="screen">
    <rosparam command="load" file="$(find sl_sensor_codec)/param/default_parameters.yaml" />
    <param name="codec_yaml_directory" type="string" value="$(find sl_sensor_codec)/codec_yaml/codec_config.yaml" /> 
    <param name="projector_yaml_directory" type="string" value="$(arg projector_yaml_directory)" /> 
    <param name="direction" type="string" value="both" />
    <param name="decoder_name" type="string" value="calibration" />
    <param name="cameras_to_decode_indices" type="string" value="0 1" />
  </node>	

  <node pkg="nodelet" type="nodelet" name="calibration_sequence_acquisition" args="load sl_sensor_calibration/CalibrationSequenceAcquisitionNodelet standalone_nodelet" output="screen">
    <rosparam command="load" file="$(find sl_sensor_calibration)/param/default_parameters.yaml" />
    <param name="save_directory" type="string" value="$(arg save_directory)" />
    <param name="save_filename" type="string" value="$(arg save_filename)" />
    <param name="number_cameras" type="int" value="2" />

    <!-- TODO Find a better way of accessing these service names -->
    <param name="image_synchroniser_service_name" type="string" value="/command_image_synchroniser" />
    <param name="projector_service_name" type="string" value="/command_projector" />
    
  </node>		  
  
  <node name="rqt_gui" pkg="rqt_gui" type="rqt_gui" args="--perspective-file $(find sl_sensor_calibration)/rqt/calibration.perspective"/>

</launch>
